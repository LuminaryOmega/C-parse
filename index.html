<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Constellation Parser Suite</title>

  <style>
    :root {
      --bg: #0d0d0f;
      --panel: #141417;
      --text: #e4e4e8;
      --subtle: #999;
      --accent-pink: #ff2fd5;
      --accent-purple: #a065ff;
      --accent-gold: #ffd86b;
      --border: #2a2a32;
      --radius: 8px;
    }

    body {
      margin: 0;
      background: var(--bg);
      color: var(--text);
      font-family: system-ui, sans-serif;
      display: flex;
      flex-direction: column;
      height: 100vh;
      overflow: hidden;
    }

    /* NAVBAR */
    .navbar {
      background: var(--panel);
      padding: 12px 20px;
      display: flex;
      align-items: center;
      gap: 12px;
      border-bottom: 1px solid var(--border);
    }
    .navbar h1 {
      margin: 0;
      font-size: 20px;
      font-weight: 600;
      color: var(--accent-pink);
    }
    .tag {
      background: var(--accent-purple);
      color: #000;
      padding: 3px 8px;
      border-radius: 6px;
      font-size: 12px;
      font-weight: bold;
    }

    /* LAYOUT */
    #layout {
      display: grid;
      grid-template-columns: 260px 1fr;
      height: calc(100vh - 52px);
    }

    /* SIDEBAR */
    .sidebar {
      background: var(--panel);
      border-right: 1px solid var(--border);
      padding: 16px;
      overflow-y: auto;
    }
    .sidebar h2 {
      margin-top: 20px;
      margin-bottom: 8px;
      color: var(--accent-purple);
      font-size: 16px;
    }

    .file-drop {
      padding: 20px;
      text-align: center;
      border: 2px dashed var(--accent-pink);
      border-radius: var(--radius);
      cursor: pointer;
      color: var(--subtle);
      margin-bottom: 16px;
    }

    .checkbox-row {
      display: flex;
      align-items: center;
      gap: 8px;
      margin-bottom: 8px;
    }

    #keyword_search {
      width: 100%;
      padding: 6px;
      border-radius: var(--radius);
      border: 1px solid var(--border);
      background: #1a1a1e;
      color: var(--text);
      margin-top: 8px;
    }

    button {
      width: 100%;
      padding: 8px;
      margin-top: 10px;
      background: var(--accent-pink);
      color: #000;
      border: none;
      border-radius: var(--radius);
      cursor: pointer;
      font-weight: bold;
    }

    /* VIEWER */
    #viewer {
      padding: 20px;
      overflow-y: auto;
      background: #111;
    }

    pre {
      white-space: pre-wrap;
      word-break: break-word;
      background: #1a1a1e;
      padding: 12px;
      border-radius: var(--radius);
      border: 1px solid var(--border);
    }

    .section-title {
      font-size: 22px;
      margin-bottom: 10px;
      color: var(--accent-gold);
    }
  </style>
</head>

<body>
  <nav id="navbar"></nav>

  <div id="layout">
    <aside id="sidebar"></aside>
    <main id="viewer"></main>
  </div>

  <script>
    /* ----------------------------------------
       NAVBAR
    ---------------------------------------- */
    document.getElementById("navbar").innerHTML = `
      <div class="navbar">
        <h1>Constellation Parser Suite</h1>
        <span class="tag">v1.0</span>
      </div>
    `;

    /* ----------------------------------------
       SIDEBAR
    ---------------------------------------- */
    document.getElementById("sidebar").innerHTML = `
      <div class="sidebar">

        <h2>Load File</h2>
        <div class="file-drop" id="file-drop">
          <p>Drop JSON / HTML / TXT here<br>or click to browse</p>
          <input type="file" id="file-input" hidden />
        </div>

        <h2>Filters</h2>
        <div class="filter-group">

          <div class="checkbox-row">
            <input type="checkbox" id="filter_user" />
            <label for="filter_user">Only User Messages</label>
          </div>

          <div class="checkbox-row">
            <input type="checkbox" id="filter_assistant" />
            <label for="filter_assistant">Only Assistant Messages</label>
          </div>

          <div class="checkbox-row">
            <input type="checkbox" id="filter_code" />
            <label for="filter_code">Only Code Blocks</label>
          </div>

          <input type="search" id="keyword_search"
                 placeholder="Keyword search..." />
        </div>

        <h2>Export</h2>
        <button id="export-btn">Export Filtered</button>

        <h2>Developer Options</h2>
        <button id="lfsl-tools-btn">LFSL Tools</button>

      </div>
    `;

    /* ----------------------------------------
       VIEWER DEFAULT
    ---------------------------------------- */
    document.getElementById("viewer").innerHTML = `
      <h2 class="section-title">Welcome</h2>
      <p style="opacity:0.75">
        Load your exported ChatGPT/OpenAI conversation data to begin.<br><br>
        Supported:
        <ul>
            <li>JSON Exports</li>
            <li>HTML Chat Files</li>
            <li>Raw Text</li>
        </ul>
        <br>
        Everything runs locally — no servers, no uploads.
      </p>
    `;

    /* ----------------------------------------
       PARSERS
    ---------------------------------------- */

    function parseJSON(text) {
      return JSON.parse(text);
    }

    function parseHTML(text) {
      const parser = new DOMParser();
      return parser.parseFromString(text, "text/html");
    }

    function parseText(text) {
      return text.split("\n");
    }

    /* ----------------------------------------
       DATASET BUILDER
    ---------------------------------------- */
    function buildDataset(messages) {
      return messages.map(m => ({
        role: m.role || "unknown",
        content: m.content || "",
      }));
    }

    /* ----------------------------------------
       EXPORT HELPER
    ---------------------------------------- */
    function downloadJSON(data, filename = "export.json") {
      const blob = new Blob(
        [JSON.stringify(data, null, 2)],
        { type: "application/json" }
      );
      const link = document.createElement("a");
      link.href = URL.createObjectURL(blob);
      link.download = filename;
      link.click();
    }

    /* ----------------------------------------
       FILE LOADER
    ---------------------------------------- */
    function handleFileLoad(file) {
      const reader = new FileReader();

      reader.onload = () => {
        const text = reader.result;
        let parsed = null;

        try { parsed = parseJSON(text); }
        catch (_) {
          try { parsed = parseHTML(text); }
          catch (_) {
            parsed = parseText(text);
          }
        }

        window.__C_PARSE_DATA__ = parsed;

        document.getElementById("viewer").innerHTML =
          `<pre>${JSON.stringify(parsed, null, 2)}</pre>`;
      };

      reader.readAsText(file);
    }

    /* ----------------------------------------
       APP INIT
    ---------------------------------------- */
    window.addEventListener("DOMContentLoaded", () => {
      console.log("✅ Constellation Parser Suite Ready");

      const drop = document.getElementById("file-drop");
      const fileInput = document.getElementById("file-input");

      drop.addEventListener("click", () => fileInput.click());
      drop.addEventListener("dragover", e => {
        e.preventDefault();
        drop.style.borderColor = "var(--accent-purple)";
      });
      drop.addEventListener("dragleave", () => {
        drop.style.borderColor = "var(--accent-pink)";
      });
      drop.addEventListener("drop", e => {
        e.preventDefault();
        drop.style.borderColor = "var(--accent-pink)";
        const file = e.dataTransfer.files[0];
        if (file) handleFileLoad(file);
      });

      fileInput.addEventListener("change", e => {
        const file = e.target.files[0];
        if (file) handleFileLoad(file);
      });
    });
  </script>
</body>
</html>
=======
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Constellation Parser Suite</title>
  <link rel="stylesheet" href="styles.css" />
</head>

<body>
  <div id="app">
    <nav id="navbar"></nav>

    <div id="layout">
      <aside id="sidebar"></aside>
      <main id="viewer"></main>
    </div>

    <!-- Hidden file input for uploads -->
    <input
      type="file"
      id="file-input"
      accept=".json,.txt,.html"
      style="display:none"
    />
  </div>

  <!-- Components -->
  <script src="src/components/navbar.js"></script>
  <script src="src/components/fileLoader.js"></script>
  <script src="src/components/filterPanel.js"></script>
  <script src="src/components/viewer.js"></script>
  <script src="src/components/exporter.js"></script>
  <script src="src/components/lfslTools.js"></script>

  <!-- Utils -->
  <script src="src/utils/parseJSON.js"></script>
  <script src="src/utils/parseHTML.js"></script>
  <script src="src/utils/parseText.js"></script>
  <script src="src/utils/datasetBuilder.js"></script>
  <script src="src/utils/fileHelpers.js"></script>

  <!-- App Core -->
  <script src="src/app.js"></script>
</body>
</html>
